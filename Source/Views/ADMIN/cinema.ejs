
<!-- -----------Main----- -->
<div class="main-panel">
    <div class="content-wrapper">
        <div class="page-header">
            <h3 class="page-title">
                <i class="fa fa-list" aria-hidden="true"></i>
                </span> Cinema Management
            </h3>
        </div>
        <!--------Cụm rạp------>
        <div class="row">
            <div class="col-md-12 grid-margin">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title" style="text-align: center;">Danh sách cụm rạp</h4>
                        <!--------- Bảng----- -->
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th> # </th>
                                        <th> Tên cụm </th>                               
                                        <th> Sửa </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if(MovieTheaterCluster) { %>
                                    <% MovieTheaterCluster.forEach(element=>{ %>
                                    <tr>
                                        <td>
                                            <input class="form-check-input" type="checkbox" value="" id="" onclick="chooseMovieTheaterCluster('<%-element.id%>')">
                                        </td>
                                        <td><%= element.id %></td>
                                        <td><%= element.Name %></td>                                      
                                        <td>
                                            <button type="button" class="btn btn-inverse-info btn-icon" data-toggle="modal" data-target="#edit-cinema-area" onclick="popupEditMovieTheaterCluster('<%- element.id %>')">
                                                <i class="fa fa-pencil" aria-hidden="true"></i>
                                            </button>
    
                                        </td>
                                    </tr>
                                    <% }) %>
                                    <% } %>
                                </tbody>
                            </table>
                            <!-- -------------------- -->
                                <!------- POPUP sửa cụm rạp--- -->
                                <div class="modal fade" id="edit-cinema-area" tabindex="-1" role="dialog">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="">Sửa cụm rạp</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form>
                                        <div class="form-group">
                                            <label for="edit-cinema-area-name" class="col-form-label">Tên cụm rạp:</label>
                                            <input type="text" class="form-control" id="edit-cinema-area-name">
                                        </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-dark" onclick="UpdateMovieTheaterCluster()">Save</button>
                                    </div>
                                    </div>
                                </div>
                                </div>
                                <!-------------------------------->
                        </div>
                        <!-- Button cụm rạp -->
                        <div class="row">
                            <div class="col-6 grid-margin" style="margin-top: 0.5rem;">
                                <button type="button" class="btn btn-gradient-dark" data-toggle="modal" data-target="#add-cinema-area"><span><i class="fa fa-plus" aria-hidden="true"></i></span>Thêm</button>
                                <button type="button" class="btn btn-inverse-danger " onclick="DeleteMovieTheaterCluster()"> <span><i class="fa fa-trash" aria-hidden="true"></i></span> Xoá lựa chọn</button>
                            </div>
                            
                            <!-- ---------------------- -->
                            <!------- POPUP thêm cụm rạp--- -->
                            <div class="modal fade" id="add-cinema-area" tabindex="-1" role="dialog">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="">Thêm cụm rạp</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form>
                                        <div class="form-group">
                                            <label for="cinema-movie-theater-cluster-name" class="col-form-label">Tên cụm rạp:</label>
                                            <input type="text" class="form-control" id="cinema-movie-theater-cluster-name">
                                        </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-dark" onclick="AddNewMovieTheaterCluster()">Add</button>
                                    </div>
                                    </div>
                                </div>
                                </div>
                                <!-------------------------------->
                                <!-- ----------Phân trang----- -->
                                <div class="col-6 grid-margin">
                                    <ul class="pagination" style="margin-top: 1rem; float: right;">
                                        <% if(pageMTCIndex>1){ %>
                                          <li class="page-item">
                                              <a class="page-link" href="/admin/cinemaManagement?pageMTCIndex=<%-pageMTCIndex-1%>" aria-label="Previous">
                                                  <span aria-hidden="true">&laquo;</span>
                                                  <span class="sr-only">Previous</span>
                                              </a>
                                          </li>
                                        <% } %>
        
                                        <%for (let i = 1; i <= pageMovieTheaterCluster; i++){
                                          if(i==pageMTCIndex){%>
                                            <li class="page-item"><a style="background-color: lightgray;" class="page-link" href="/admin/cinemaManagement?pageMTCIndex=<%-i%>"><%-i%></a></li>
                                          <%} else {%>
                                            <li class="page-item"><a class="page-link" href="/admin/cinemaManagement?pageMTCIndex=<%-i%>"><%-i%></a></li>
                                        <%}}%>
        
                                        <% if(pageMTCIndex < pageMovieTheaterCluster){ %>
                                        <li class="page-item">
                                            <a class="page-link" href="/admin/cinemaManagement?pageMTCIndex=<%-parseInt(pageMTCIndex) + 1%>" aria-label="Next">
                                                <span aria-hidden="true">&raquo;</span>
                                                <span class="sr-only">Next</span>
                                            </a>
                                        </li>
                                        <% } %>
                                    </ul>
                                </div>
                            <!-- ------------------------------------ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ---------Rạp------- -->
        <div class="row">
            <div class="col-md-12 grid-margin ">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title" style="text-align: center;">Danh sách rạp</h4>
                        <!-- Chọn cụm -->
                        <div class="select" style="text-align: center;">
                            <select class="custom-select" id="cb-cinema-location-1" onchange="changeLocation('1')">
                                <option value="all" id="location_0-1">Tất cả</option>
                                <% for(var item of Locations){ %>                        
                                    <option value="<%- item.id %>" id="location_<%-item.id%>-1"><%- item.Name %></option>
                                <%}%>
                                </select>
                        </div>
                        
                            <!-- ----------- -->
                            <!-- Bảng -->
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th> # </th>
                                        <th> Tên rạp </th>
                                        <th> Địa chỉ </th>
                                        <th> Sửa </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><input class="form-check-input" type="checkbox" value="" id=""></td>
                                        <td> 1 </td>
                                        <td> Cinema Q1 </td>
                                        <td> 1 Nguyễn Thị Minh Khai</td>
                                        <td>
                                            <button type="button" class="btn btn-inverse-info btn-icon" data-toggle="modal" data-target="#edit-cinema">
                                                <i class="fa fa-pencil" aria-hidden="true"></i>
                                            </button>
                                            
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><input class="form-check-input" type="checkbox" value="" id=""></td>
                                        <td> 2 </td>
                                        <td> Cinema Q5</td>
                                        <td> 2 Nguyễn Văn Cừ</td>
                                        <td>
                                            <button type="button" class="btn btn-inverse-info btn-icon" data-toggle="modal" data-target="#edit-cinema">
                                                <i class="fa fa-pencil" aria-hidden="true"></i>
                                            </button>
                                            
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><input class="form-check-input" type="checkbox" value="" id=""></td>
                                        <td> 3 </td>
                                        <td> Cinema Thủ Đức </td>
                                        <td> 3 Kha Vạn Cân</td>
                                        <td>
                                            <button type="button" class="btn btn-inverse-info btn-icon" data-toggle="modal" data-target="#edit-cinema">
                                                <i class="fa fa-pencil" aria-hidden="true"></i>
                                            </button>
                                            
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <!------- POPUP sửa rạp--- -->
                            <div class="modal fade" id="edit-cinema" tabindex="-1" role="dialog">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="">Sửa rạp phim</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form>
                                        <div class="form-group">
                                            <label for="cinema-arena-name" class="col-form-label">Tên rạp:</label>
                                            <input type="text" class="form-control" id="cinema-arena-name" value="Cinema Q1">
                                        </div>
                                        <div class="form-group">
                                            <label for="cinema-arena-address" class="col-form-label">Địa chỉ rạp:</label>
                                            <input type="text" class="form-control" id="cinema-arena-address" value="1 Nguyễn Thị Minh Khai">
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-dark" >Save</button>
                                    </div>
                                    </div>
                                </div>
                                </div>
                                <!-------------------------------->
                        </div>
                        <!-- -------------------------- -->
                        <div class="row">
                            <div class="col-6 grid-margin" style="margin-top: 0.5rem;">
                                <button type="button" class="btn btn-gradient-dark"  data-toggle="modal" data-target="#add-cinema"><span><i class="fa fa-plus" aria-hidden="true"></i></span>Thêm</button>
                                <button type="button" class="btn btn-inverse-danger "> <span><i class="fa fa-trash" aria-hidden="true" onclick="DeleteMovieTheater()"></i></span> Xoá lựa chọn</button>
                            </div>
                                <!------- POPUP thêm rạp--- -->
                                <div class="modal fade" id="add-cinema" tabindex="-1" role="dialog">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="">Thêm rạp phim</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form>
                                        <div class="form-group">
                                            <label for="cinema-arena-name" class="col-form-label">Tên rạp:</label>
                                            <input type="text" class="form-control" id="cinema-arena-name" >
                                        </div>
                                        <div class="form-group">
                                            <label for="cinema-arena-address" class="col-form-label">Địa chỉ rạp:</label>
                                            <input type="text" class="form-control" id="cinema-arena-address" >
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-dark">Add</button>
                                    </div>
                                    </div>
                                </div>
                                </div>
                                <!-------------------------------->
                                <!-------- Phân trang--- -->
                            <div class="col-6 grid-margin">
                                <ul class="pagination" style="margin-top: 1rem; float: right;">
                                    <li class="page-item">
                                        <a class="page-link" href="#" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                            <span class="sr-only">Previous</span>
                                        </a>
                                    </li>
                                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                            <span class="sr-only">Next</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <!-- ----------------------- -->
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>


<script>

window.onload = function() {
  const locationId='<%-locationId %>';
  
  if(locationId!='all')
  {
    $("#location_"+locationId+'-1').attr("selected", "selected");
    $.ajax({
        type: "GET",
        url: "/admin/cinemamanagement/getlistcinema?locationid="+locationId,
        contentType: "application/json",
        success: function(data){
            if(data && data!="F")
            {

                const listCinema=JSON.parse(data);

                for(var item of listCinema)
                {
                  const id=item.id;
                  const name=item.Name;
                  $('#cb-showtime-cinema-1').append('<option value="'+id+'" id="cinema_'+id+'-1">'+name+'</option>');
                }
                if(cinemaId!='all')
                {
                  // console.log(cinemaId);
                  // alert(document.getElementById("cinema_"+cinemaId+'-1').value);
                  $("#cinema_"+cinemaId+"-1").attr("selected", "selected");
                }
                else
                {
                  $("#cinema_0-1").attr("selected", "selected");
                }
            }
            else
            {
                alert("Somthing error !!!");
            }
        }
      });    
  }
  else
  {
    $("#location_0-1").attr("selected", "selected");
    $("#cinema_0-1").attr("selected", "selected");
  }
};

function changeLocation(idCombobox)
{

    var LocationId = document.getElementById("cb-cinema-location-"+idCombobox).value;
    if(LocationId=='all')
    {
        location.replace('/admin/cinemamanagement');
    }
    else
    {
    //ajax
        $.ajax({
        type: "GET",
        url: "/admin/cinemamanagement/getlistcinema?locationid="+LocationId,
        contentType: "application/json",
        success: function(data){
            if(data && data!="F")
            {
               return;
            }
            else
            {
                alert("Somthing error !!!");
            }
        }
        });    
    }

}

var listChooseMovieTheaterCluster=new Object();
var idMovieTheaterClusterEdit=null;

function chooseMovieTheaterCluster(id)
{
    if(!listChooseMovieTheaterCluster.hasOwnProperty(id))
        listChooseMovieTheaterCluster[id]=1; //choosen
    else
    {
        delete listChooseMovieTheaterCluster[id];
    }
}

function popupEditMovieTheaterCluster(id)
{
  '<% for(var item of MovieTheaterCluster) {%>'
    if('<%-item.id%>'==id)
    {
      $('#edit-cinema-area-name').val('<%- item.Name %>');
    }
  '<% } %>'

  idMovieTheaterClusterEdit=id; //get id movie
}

function UpdateMovieTheaterCluster()
{
  //new data to update
  var movieTheaterCluster = new Object();
  movieTheaterCluster.id = idMovieTheaterClusterEdit;
  movieTheaterCluster.Name=$('#edit-cinema-area-name').val();

  //ajax 
  $.ajax({
    type: "POST",
    url: "/admin/cinemamanagement/updatecinema",
    contentType: "application/json",
    data: JSON.stringify({movieTheaterClusterUpdate : movieTheaterCluster}),
    dataType: 'json',
    success: function(data)
    {
      if(data=="OK")
      {
        alert('Update success');
        location.reload();
      }
      else
      {
        alert("Somthing error !!!");
      }
    }
  })
}

function DeleteMovieTheaterCluster()
{
    var listIdMovieTheaterClusterDelete= Object.keys(listChooseMovieTheaterCluster).map((key) => key);
    if(listIdMovieTheaterClusterDelete.length==0)
    {
        alert("You have not selected item");
    }
    else
    {
        //ajax
        $.ajax({
            type: "POST",
            url: "/admin/cinemamanagement/deletecinema",
            contentType: "application/json",
            data: JSON.stringify({listIdMovieTheaterCluster : listIdMovieTheaterClusterDelete}),
            dataType: 'json',
            success: function(data)
            {
                if(data=="OK")
                {
                    alert('Delete success');
                    location.reload();
                }
                else
                {
                    alert("Somthing error !!!");
                }
            }
        })
    }
}



function AddNewMovieTheaterCluster()
{
    var movieTheaterClusterNew=new Object();
    movieTheaterClusterNew.Name=$('#cinema-movie-theater-cluster-name').val();

    //ajax 
    $.ajax({
    type: "POST",
    url: "/admin/cinemamanagement/addcinema",
    contentType: "application/json",
    data: JSON.stringify({movieTheaterClusterNew : movieTheaterClusterNew}),
    dataType: 'json',
    success: function(data)
    {
      if(data=="OK")
      {
        alert('Add success');
        location.reload();
      }
      else
      {
        alert("Somthing error !!!");
      }
    }
  })
}

/*----------------------------------------------MovieTheater --------------------------------*/
var listChooseMovieTheater=new Object();
var idMovieTheaterEdit=null;

function chooseMovieTheater(id)
{
    if(!listChooseMovieTheater.hasOwnProperty(id))
        listChooseMovieTheater[id]=1; //choosen
    else
    {
        delete listChooseMovieTheater[id];
    }
}


function DeleteMovieTheater()
{
    var listIdMovieTheaterDelete = Object.keys(listChooseMovieTheater).map((key) => key);
    if(listIdMovieTheaterDelete.length==0)
    {
        alert("You have not selected item");
    }
    else
    {
        //ajax
        $.ajax({
            type: "POST",
            url: "/admin/cinemamanagement/deletemovietheater",
            contentType: "application/json",
            data: JSON.stringify({listIdMovieTheater : listIdMovieTheaterDelete}),
            dataType: 'json',
            success: function(data)
            {
                if(data=="OK")
                {
                    alert('Delete success');
                    location.reload();
                }
                else
                {
                    alert("Somthing error !!!");
                }
            }
        })
    }
}
</script>